# 数据模型设计

## 1. 核心实体

### 1.1 医生信息表 (Doctor)

```sql
CREATE TABLE doctors (
    id VARCHAR(20) PRIMARY KEY,              -- 医生ID (如: DOC0001)
    name VARCHAR(50) NOT NULL,               -- 姓名
    title VARCHAR(30),                       -- 职称
    region VARCHAR(30),                      -- 地区
    department VARCHAR(50),                  -- 科室
    agency_name VARCHAR(100),                -- 机构名称
    agency_price DECIMAL(10,2),              -- 机构报价（元/条）
    total_followers INTEGER DEFAULT 0,       -- 总粉丝量
    total_likes INTEGER DEFAULT 0,           -- 总获赞量
    total_works INTEGER DEFAULT 0,           -- 总作品数
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

### 1.2 医生数据指标表 (DoctorMetrics)

```sql
CREATE TABLE doctor_metrics (
    id SERIAL PRIMARY KEY,
    doctor_id VARCHAR(20) REFERENCES doctors(id),
    
    -- 7天数据
    likes_7d INTEGER DEFAULT 0,             -- 7天新增点赞
    followers_7d INTEGER DEFAULT 0,         -- 7天净增粉丝
    shares_7d INTEGER DEFAULT 0,            -- 7天新增分享
    comments_7d INTEGER DEFAULT 0,          -- 7天新增评论
    works_7d INTEGER DEFAULT 0,             -- 7天新增作品
    
    -- 15天数据
    likes_15d INTEGER DEFAULT 0,            -- 15天新增点赞
    followers_15d INTEGER DEFAULT 0,        -- 15天净增粉丝
    shares_15d INTEGER DEFAULT 0,           -- 15天新增分享
    comments_15d INTEGER DEFAULT 0,         -- 15天新增评论
    works_15d INTEGER DEFAULT 0,            -- 15天新增作品
    
    -- 30天数据
    likes_30d INTEGER DEFAULT 0,            -- 30天新增点赞
    followers_30d INTEGER DEFAULT 0,        -- 30天净增粉丝
    shares_30d INTEGER DEFAULT 0,           -- 30天新增分享
    comments_30d INTEGER DEFAULT 0,         -- 30天新增评论
    works_30d INTEGER DEFAULT 0,            -- 30天新增作品
    
    -- 记录时间
    recorded_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

### 1.3 人工评分表 (DoctorScores)

```sql
CREATE TABLE doctor_scores (
    id SERIAL PRIMARY KEY,
    doctor_id VARCHAR(20) REFERENCES doctors(id),
    
    -- 人工评分项 (0-10分)
    performance_score DECIMAL(3,1),         -- 医生表现力评分
    affinity_score DECIMAL(3,1),            -- 医生亲和力评分
    editing_score DECIMAL(3,1),             -- 剪辑水平评分
    video_quality_score DECIMAL(3,1),       -- 画面质量评分
    
    -- 评分人员和时间
    scorer_id VARCHAR(50),                   -- 评分人员ID
    scored_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

### 1.4 计算指标表 (CalculatedIndicators)

```sql
CREATE TABLE calculated_indicators (
    id SERIAL PRIMARY KEY,
    doctor_id VARCHAR(20) REFERENCES doctors(id),
    
    -- 账号性质分类
    account_type VARCHAR(20),                -- head/middle/tail
    account_type_score DECIMAL(5,2),        -- 账号性质评分
    
    -- 性价比指数
    cost_effectiveness_index DECIMAL(5,2),  -- 性价比指数
    
    -- 数据指数
    data_trend_index DECIMAL(5,2),          -- 数据趋势指数
    growth_stability_index DECIMAL(5,2),    -- 增长稳定性指数
    
    -- 内容质量指数
    content_quality_index DECIMAL(5,2),     -- 内容质量指数
    
    -- 综合指数
    comprehensive_index DECIMAL(5,2),       -- 综合评价指数
    
    -- 计算时间和版本
    calculated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    weight_config_id INTEGER,               -- 使用的权重配置ID
    
    UNIQUE(doctor_id, calculated_at)
);
```

### 1.5 权重配置表 (WeightConfigs)

```sql
CREATE TABLE weight_configs (
    id SERIAL PRIMARY KEY,
    name VARCHAR(50) NOT NULL,               -- 配置名称
    description TEXT,                        -- 配置描述
    
    -- 各项指标权重 (总和为100)
    account_type_weight DECIMAL(5,2),       -- 账号性质权重
    cost_effectiveness_weight DECIMAL(5,2), -- 性价比权重
    data_trend_weight DECIMAL(5,2),         -- 数据趋势权重
    performance_weight DECIMAL(5,2),        -- 表现力权重
    affinity_weight DECIMAL(5,2),           -- 亲和力权重
    editing_weight DECIMAL(5,2),            -- 剪辑水平权重
    video_quality_weight DECIMAL(5,2),      -- 画面质量权重
    
    -- 元数据
    is_default BOOLEAN DEFAULT FALSE,       -- 是否为默认配置
    created_by VARCHAR(50),                 -- 创建人
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

### 1.6 系统配置表 (SystemConfigs)

```sql
CREATE TABLE system_configs (
    id SERIAL PRIMARY KEY,
    config_key VARCHAR(50) UNIQUE NOT NULL,
    config_value TEXT,
    description TEXT,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 默认配置数据
INSERT INTO system_configs (config_key, config_value, description) VALUES
('account_head_threshold', '500000', '头部账号粉丝量阈值'),
('account_middle_threshold', '100000', '腰部账号粉丝量阈值'),
('cost_base_price', '5000', '性价比计算基准价格'),
('trend_weight_7d', '0.5', '7天数据权重'),
('trend_weight_15d', '0.3', '15天数据权重'),
('trend_weight_30d', '0.2', '30天数据权重');
```

## 2. 数据关系图

```
doctors (1) ←→ (N) doctor_metrics
doctors (1) ←→ (1) doctor_scores  
doctors (1) ←→ (N) calculated_indicators
weight_configs (1) ←→ (N) calculated_indicators
```

## 3. 索引设计

```sql
-- 性能优化索引
CREATE INDEX idx_doctors_region_dept ON doctors(region, department);
CREATE INDEX idx_metrics_doctor_recorded ON doctor_metrics(doctor_id, recorded_at);
CREATE INDEX idx_indicators_doctor_calc ON calculated_indicators(doctor_id, calculated_at);
CREATE INDEX idx_indicators_comprehensive ON calculated_indicators(comprehensive_index DESC);
```

## 4. 数据字典

### 4.1 账号性质分类 (account_type)
- `head`: 头部账号 (粉丝量 ≥ 500,000)
- `middle`: 腰部账号 (100,000 ≤ 粉丝量 < 500,000)  
- `tail`: 尾部账号 (粉丝量 < 100,000)

### 4.2 评分范围
- 人工评分: 0-10分，保留1位小数
- 计算指数: 0-100分，保留2位小数
- 权重值: 0-100，总和必须为100

### 4.3 数据更新频率
- 医生基础信息: 手动更新
- 数据指标: 每日更新
- 人工评分: 按需更新
- 计算指标: 实时计算或定时批处理
